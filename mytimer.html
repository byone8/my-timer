<!DOCTYPE html>
<html>
<head>
    <!-- 기존 head 내용 유지 -->
    <!-- Firebase SDK 추가 -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- 기존 body 내용 유지 -->

    <script>
        // Firebase 구성 정보
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebase 초기화
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // 사용자 상태 관리 변수
        let userId = null;
        let timerRef = null;

        // 사용자 인증 처리
        auth.signInAnonymously()
            .then(() => {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        userId = user.uid;
                        timerRef = database.ref(`timers/${userId}`);
                        setupRealtimeListener();
                    }
                });
            })
            .catch((error) => {
                console.error('인증 오류:', error);
            });

        // 실시간 데이터베이스 리스너 설정
        function setupRealtimeListener() {
            timerRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    startTime = data.startTime;
                    projectName = data.projectName;
                    startDate = new Date(startTime);

                    if (startTime && !timerInterval) {
                        timerInterval = setInterval(updateTimer, 10);
                        timerElement.classList.add('running');
                        projectNameInput.value = projectName;
                        projectDisplayElement.textContent = "프로젝트명: " + projectName;
                    } else if (!startTime && timerInterval) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        timerElement.classList.remove('running');
                    }
                }
            });
        }

        // 상태 저장 함수 수정
        function saveStateToServer(state) {
            if (timerRef) {
                timerRef.set(state);
            }
        }

        // 기존 localStorage 관련 함수 수정
        function loadSavedState() {
            // 로컬 스토리지 대신 서버에서 상태 가져옴
        }

        function startTimer() {
            startTime = Date.now();
            startDate = new Date();
            projectName = projectNameInput.value;

            const state = {
                startTime: startTime,
                projectName: projectName
            };

            saveStateToServer(state);
            // 나머지 기존 코드 유지
        }

        function stopTimer() {
            const state = {
                startTime: null,
                projectName: null
            };
            saveStateToServer(state);
            // 나머지 기존 코드 유지
        }

        function resetTimer() {
            const state = {
                startTime: null,
                projectName: null
            };
            saveStateToServer(state);
            // 나머지 기존 코드 유지
        }

        // 나머지 기존 코드 유지
    </script>
</body>
</html>
